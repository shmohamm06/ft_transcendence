[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  override existing env vars with { override: true })
Environment variables loaded: { CLIENT_ID: 'LOADED', CLIENT_SECRET: 'LOADED', JWT_SECRET: 'LOADED' }
Database path: /home/shmohamm06/trans/ft_transcendence/backend/auth-service/db.sqlite
Initializing database...
Database initialized successfully.
{"level":30,"time":1754060620655,"pid":11209,"hostname":"Shahriars-Laptop","msg":"Server listening at http://0.0.0.0:3001"}
Database connection opened successfully
Users table created/verified
Game_settings table created/verified
User_stats table created/verified
Missing user_stats records created for existing users
{"level":30,"time":1754060635350,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-1","req":{"method":"GET","url":"/api/users/oauth/42/authorize","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":44066},"msg":"incoming request"}
(node:11209) [FSTDEP021] DeprecationWarning: The `reply.redirect()` method has a new signature: `reply.redirect(url: string, code?: number)`. It will be enforced in `fastify@v5`
(Use `node --trace-deprecation ...` to show where the warning was created)
{"level":30,"time":1754060635357,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-1","res":{"statusCode":302},"responseTime":5.647092999890447,"msg":"request completed"}
{"level":30,"time":1754060636047,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-2","req":{"method":"POST","url":"/api/users/oauth/42/callback","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":44070},"msg":"incoming request"}
OAuth callback received: {
  method: 'POST',
  url: '/api/users/oauth/42/callback',
  body: {
    code: 'f29440b74ab62707451162a2bf26f9e01aa820cfa62ae66da7e47d97b0f4a930',
    state: 'fcngvojtu7i'
  },
  query: {},
  headers: {
    'sec-fetch-site': 'same-origin',
    'sec-fetch-mode': 'cors',
    'sec-fetch-dest': 'empty',
    referer: 'http://localhost:3000/auth/42/callback?code=f29440b74ab62707451162a2bf26f9e01aa820cfa62ae66da7e47d97b0f4a930&state=fcngvojtu7i',
    connection: 'close',
    origin: 'http://localhost:3000',
    'content-length': '97',
    'content-type': 'application/json',
    'accept-encoding': 'gzip, deflate, br, zstd',
    'accept-language': 'en-US,en;q=0.5',
    accept: 'application/json, text/plain, */*',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:141.0) Gecko/20100101 Firefox/141.0',
    host: 'localhost:3001'
  }
}
Processing OAuth callback with code: f29440b74a...
Exchanging code for token with: {
  grant_type: 'authorization_code',
  client_id: 'u-s4t2ud-c9b994e544f314d00e5c9704fd12bad9a0535c183d2444bc9c44329a7ff29ab1',
  client_secret: '[HIDDEN]',
  code: 'f29440b74a...',
  redirect_uri: 'http://localhost:3000/auth/42/callback',
  url: 'https://api.intra.42.fr/oauth/token'
}
Token exchange successful
OAuth: User from database: {
  user: {
    id: 14,
    username: 'shmohamm',
    email: 'shmohamm@student.42abudhabi.ae',
    avatar: 'https://cdn.intra.42.fr/users/d952ccc5959f843c689ee6f77958d9af/medium_shmohamm.jpg',
    intra_id: 150583,
    intra_login: 'shmohamm',
    auth_provider: '42'
  },
  hasId: true,
  idType: 'number',
  keys: [
    'id',
    'username',
    'email',
    'avatar',
    'intra_id',
    'intra_login',
    'auth_provider'
  ]
}
OAuth: Sending response user: {
  responseUser: {
    id: 14,
    username: 'shmohamm',
    email: 'shmohamm@student.42abudhabi.ae',
    avatar: 'https://cdn.intra.42.fr/users/d952ccc5959f843c689ee6f77958d9af/medium_shmohamm.jpg',
    auth_provider: '42'
  },
  hasId: true,
  idType: 'number',
  serialized: '{"id":14,"username":"shmohamm","email":"shmohamm@student.42abudhabi.ae","avatar":"https://cdn.intra.42.fr/users/d952ccc5959f843c689ee6f77958d9af/medium_shmohamm.jpg","auth_provider":"42"}'
}
OAuth: Final response data: {
  responseData: {
    accessToken: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTQsInVzZXJuYW1lIjoic2htb2hhbW0iLCJlbWFpbCI6InNobW9oYW1tQHN0dWRlbnQuNDJhYnVkaGFiaS5hZSIsImF2YXRhciI6Imh0dHBzOi8vY2RuLmludHJhLjQyLmZyL3VzZXJzL2Q5NTJjY2M1OTU5Zjg0M2M2ODllZTZmNzc5NThkOWFmL21lZGl1bV9zaG1vaGFtbS5qcGciLCJpbnRyYV9pZCI6MTUwNTgzLCJpbnRyYV9sb2dpbiI6InNobW9oYW1tIiwiYXV0aF9wcm92aWRlciI6IjQyIiwiaWF0IjoxNzU0MDYwNjM3fQ.lImX-aHBy6vhHoO37Tl7FciVfx5LYCn1-3X-jg0bL0A',
    user: {
      id: 14,
      username: 'shmohamm',
      email: 'shmohamm@student.42abudhabi.ae',
      avatar: 'https://cdn.intra.42.fr/users/d952ccc5959f843c689ee6f77958d9af/medium_shmohamm.jpg',
      auth_provider: '42'
    }
  },
  serializedResponse: '{"accessToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTQsInVzZXJuYW1lIjoic2htb2hhbW0iLCJlbWFpbCI6InNobW9oYW1tQHN0dWRlbnQuNDJhYnVkaGFiaS5hZSIsImF2YXRhciI6Imh0dHBzOi8vY2RuLmludHJhLjQyLmZyL3VzZXJzL2Q5NTJjY2M1OTU5Zjg0M2M2ODllZTZmNzc5NThkOWFmL21lZGl1bV9zaG1vaGFtbS5qcGciLCJpbnRyYV9pZCI6MTUwNTgzLCJpbnRyYV9sb2dpbiI6InNobW9oYW1tIiwiYXV0aF9wcm92aWRlciI6IjQyIiwiaWF0IjoxNzU0MDYwNjM3fQ.lImX-aHBy6vhHoO37Tl7FciVfx5LYCn1-3X-jg0bL0A","user":{"id":14,"username":"shmohamm","email":"shmohamm@student.42abudhabi.ae","avatar":"https://cdn.intra.42.fr/users/d952ccc5959f843c689ee6f77958d9af/medium_shmohamm.jpg","auth_provider":"42"}}'
}
{"level":30,"time":1754060637467,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-2","res":{"statusCode":200},"responseTime":1419.5244439998642,"msg":"request completed"}
{"level":30,"time":1754060641837,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-3","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":58144},"msg":"incoming request"}
{"level":30,"time":1754060641843,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-3","res":{"statusCode":200},"responseTime":5.974140000063926,"msg":"request completed"}
{"level":30,"time":1754060641855,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-4","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":58160},"msg":"incoming request"}
{"level":30,"time":1754060641858,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-4","res":{"statusCode":200},"responseTime":2.6300600001122802,"msg":"request completed"}
{"level":30,"time":1754060645233,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-5","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":58174},"msg":"incoming request"}
{"level":30,"time":1754060645236,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-5","res":{"statusCode":200},"responseTime":2.271851999917999,"msg":"request completed"}
{"level":30,"time":1754060645251,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-6","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":58178},"msg":"incoming request"}
{"level":30,"time":1754060645255,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-6","res":{"statusCode":200},"responseTime":3.7984029999934137,"msg":"request completed"}
{"level":30,"time":1754060652066,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-7","req":{"method":"GET","url":"/api/settings","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":34372},"msg":"incoming request"}
{"level":30,"time":1754060652068,"pid":11209,"hostname":"Shahriars-Laptop","reqId":"req-7","res":{"statusCode":200},"responseTime":1.7334680000785738,"msg":"request completed"}
