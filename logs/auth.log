
> auth-service@1.0.0 dev
> nodemon src/app.ts

[33m[nodemon] 3.1.10[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching path(s): *.*[39m
[33m[nodemon] watching extensions: ts,json[39m
[32m[nodemon] starting `ts-node src/app.ts`[39m
/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/ts-node/src/index.ts:859
    return new TSError(diagnosticText, diagnosticCodes, diagnostics);
           ^
TSError: тип Unable to compile TypeScript:
src/app.ts(3,18): error TS2307: Cannot find module '@fastify/cors' or its corresponding type declarations.

    at createTSError (/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/ts-node/src/index.ts:859:12)
    at reportTSError (/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/ts-node/src/index.ts:863:19)
    at getOutput (/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/ts-node/src/index.ts:1077:36)
    at Object.compile (/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/ts-node/src/index.ts:1433:41)
    at Module.m._compile (/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/ts-node/src/index.ts:1617:30)
    at loadTS (node:internal/modules/cjs/loader:1826:10)
    at Object.require.extensions.<computed> [as .ts] (/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/ts-node/src/index.ts:1621:12)
    at Module.load (node:internal/modules/cjs/loader:1469:32)
    at Function._load (node:internal/modules/cjs/loader:1286:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14) {
  diagnosticCodes: [ 2307 ]
}
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `ts-node src/app.ts`[39m
Error: dlopen(/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/sqlite3/build/Release/node_sqlite3.node, 0x0001): tried: '/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/sqlite3/build/Release/node_sqlite3.node' (not a mach-o file), '/System/Volumes/Preboot/Cryptexes/OS/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/sqlite3/build/Release/node_sqlite3.node' (no such file), '/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/sqlite3/build/Release/node_sqlite3.node' (not a mach-o file)
    at Object..node (node:internal/modules/cjs/loader:1925:18)
    at Module.load (node:internal/modules/cjs/loader:1469:32)
    at Function._load (node:internal/modules/cjs/loader:1286:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Module.require (node:internal/modules/cjs/loader:1491:12)
    at require (node:internal/modules/helpers:135:16)
    at bindings (/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/bindings/bindings.js:112:48)
    at Object.<anonymous> (/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/sqlite3/lib/sqlite3-binding.js:1:37)
    at Module._compile (node:internal/modules/cjs/loader:1734:14) {
  code: 'ERR_DLOPEN_FAILED'
}
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `ts-node src/app.ts`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `ts-node src/app.ts`[39m
Error: dlopen(/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/sqlite3/build/Release/node_sqlite3.node, 0x0001): tried: '/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/sqlite3/build/Release/node_sqlite3.node' (not a mach-o file), '/System/Volumes/Preboot/Cryptexes/OS/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/sqlite3/build/Release/node_sqlite3.node' (no such file), '/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/sqlite3/build/Release/node_sqlite3.node' (not a mach-o file)
    at Object..node (node:internal/modules/cjs/loader:1925:18)
    at Module.load (node:internal/modules/cjs/loader:1469:32)
    at Function._load (node:internal/modules/cjs/loader:1286:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Module.require (node:internal/modules/cjs/loader:1491:12)
    at require (node:internal/modules/helpers:135:16)
    at bindings (/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/bindings/bindings.js:112:48)
    at Object.<anonymous> (/Users/mac/Desktop/check/ft_transcendence/backend/auth-service/node_modules/sqlite3/lib/sqlite3-binding.js:1:37)
    at Module._compile (node:internal/modules/cjs/loader:1734:14) {
  code: 'ERR_DLOPEN_FAILED'
}
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `ts-node src/app.ts`[39m
/Users/mac/.nvm/versions/node/v23.11.0/lib/node_modules/ts-node/src/index.ts:859
    return new TSError(diagnosticText, diagnosticCodes, diagnostics);
           ^
TSError: тип Unable to compile TypeScript:
src/app.ts(1,21): error TS2307: Cannot find module 'fastify' or its corresponding type declarations.
src/app.ts(2,17): error TS2307: Cannot find module '@fastify/jwt' or its corresponding type declarations.
src/app.ts(3,18): error TS2307: Cannot find module '@fastify/cors' or its corresponding type declarations.
src/app.ts(9,46): error TS2307: Cannot find module 'fastify' or its corresponding type declarations.
src/app.ts(55,5): error TS2580: Cannot find name 'process'. Do you need to install type definitions for node? Try `npm i --save-dev @types/node`.

    at createTSError (/Users/mac/.nvm/versions/node/v23.11.0/lib/node_modules/ts-node/src/index.ts:859:12)
    at reportTSError (/Users/mac/.nvm/versions/node/v23.11.0/lib/node_modules/ts-node/src/index.ts:863:19)
    at getOutput (/Users/mac/.nvm/versions/node/v23.11.0/lib/node_modules/ts-node/src/index.ts:1077:36)
    at Object.compile (/Users/mac/.nvm/versions/node/v23.11.0/lib/node_modules/ts-node/src/index.ts:1433:41)
    at Module.m._compile (/Users/mac/.nvm/versions/node/v23.11.0/lib/node_modules/ts-node/src/index.ts:1617:30)
    at loadTS (node:internal/modules/cjs/loader:1826:10)
    at Object.require.extensions.<computed> [as .ts] (/Users/mac/.nvm/versions/node/v23.11.0/lib/node_modules/ts-node/src/index.ts:1621:12)
    at Module.load (node:internal/modules/cjs/loader:1469:32)
    at Function._load (node:internal/modules/cjs/loader:1286:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14) {
  diagnosticCodes: [ 2307, 2307, 2307, 2307, 2580 ]
}
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `ts-node src/app.ts`[39m
Database path: /Users/mac/Desktop/check/ft_transcendence/backend/auth-service/db.sqlite
Initializing database...
Database initialized successfully.
{"level":30,"time":1751993277703,"pid":21136,"hostname":"macs-MacBook-Pro.local","msg":"Server listening at http://0.0.0.0:3001"}
Database connection opened successfully
Users table created/verified
Game_settings table created/verified
User_stats table created/verified
{"level":30,"time":1751993301138,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-1","req":{"method":"POST","url":"/api/users/register","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54724},"msg":"incoming request"}
Registration failed: SQLITE_CONSTRAINT: UNIQUE constraint failed: users.username
Full error: [Error: SQLITE_CONSTRAINT: UNIQUE constraint failed: users.username] {
  errno: 19,
  code: 'SQLITE_CONSTRAINT'
}
{"level":30,"time":1751993301200,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-1","res":{"statusCode":409},"responseTime":62.222583293914795,"msg":"request completed"}
{"level":30,"time":1751993313712,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-2","req":{"method":"POST","url":"/api/users/register","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54748},"msg":"incoming request"}
{"level":30,"time":1751993313772,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-2","res":{"statusCode":201},"responseTime":60.363916873931885,"msg":"request completed"}
{"level":30,"time":1751993320672,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-3","req":{"method":"POST","url":"/api/users/register","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54749},"msg":"incoming request"}
Registration failed: SQLITE_CONSTRAINT: UNIQUE constraint failed: users.username
Full error: [Error: SQLITE_CONSTRAINT: UNIQUE constraint failed: users.username] {
  errno: 19,
  code: 'SQLITE_CONSTRAINT'
}
{"level":30,"time":1751993320732,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-3","res":{"statusCode":409},"responseTime":59.48799991607666,"msg":"request completed"}
{"level":30,"time":1751993339425,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-4","req":{"method":"POST","url":"/api/users/login","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54787},"msg":"incoming request"}
{"level":30,"time":1751993339508,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-4","res":{"statusCode":200},"responseTime":82.87529230117798,"msg":"request completed"}
{"level":30,"time":1751993343261,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-5","req":{"method":"GET","url":"/api/users/nonexistent","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54790},"msg":"incoming request"}
{"level":30,"time":1751993343261,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-5","msg":"Route GET:/api/users/nonexistent not found"}
{"level":30,"time":1751993343262,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-5","res":{"statusCode":404},"responseTime":0.6451668739318848,"msg":"request completed"}
{"level":30,"time":1751993343268,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-6","req":{"method":"POST","url":"/api/users/register","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54793},"msg":"incoming request"}
{"level":30,"time":1751993343345,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-6","res":{"statusCode":201},"responseTime":77.63087511062622,"msg":"request completed"}
{"level":30,"time":1751993343355,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-7","req":{"method":"POST","url":"/api/users/register","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54796},"msg":"incoming request"}
{"level":30,"time":1751993343411,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-7","res":{"statusCode":201},"responseTime":56.49612474441528,"msg":"request completed"}
{"level":30,"time":1751993379604,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-8","req":{"method":"POST","url":"/api/users/register","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54800},"msg":"incoming request"}
{"level":30,"time":1751993379685,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-8","res":{"statusCode":201},"responseTime":80.08512496948242,"msg":"request completed"}
{"level":30,"time":1751993389041,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-9","req":{"method":"POST","url":"/api/users/login","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54806},"msg":"incoming request"}
{"level":30,"time":1751993389122,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-9","res":{"statusCode":200},"responseTime":81.17675018310547,"msg":"request completed"}
{"level":30,"time":1751993391896,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-a","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54809},"msg":"incoming request"}
{"level":30,"time":1751993391899,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-a","res":{"statusCode":200},"responseTime":3.45912504196167,"msg":"request completed"}
{"level":30,"time":1751993391902,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-b","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54812},"msg":"incoming request"}
{"level":30,"time":1751993391907,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-b","res":{"statusCode":200},"responseTime":4.108749866485596,"msg":"request completed"}
{"level":30,"time":1751993399093,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-c","req":{"method":"POST","url":"/api/users/11/stats","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54818},"msg":"incoming request"}
{"level":30,"time":1751993399096,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-c","res":{"statusCode":200},"responseTime":3.2320003509521484,"msg":"request completed"}
{"level":30,"time":1751993404037,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-d","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54821},"msg":"incoming request"}
{"level":30,"time":1751993404040,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-d","res":{"statusCode":200},"responseTime":2.220749855041504,"msg":"request completed"}
{"level":30,"time":1751993404042,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-e","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54824},"msg":"incoming request"}
{"level":30,"time":1751993404044,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-e","res":{"statusCode":200},"responseTime":1.1839170455932617,"msg":"request completed"}
{"level":30,"time":1751993436323,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-f","req":{"method":"POST","url":"/api/users/11/stats","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54831},"msg":"incoming request"}
{"level":30,"time":1751993436325,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-f","res":{"statusCode":200},"responseTime":2.362791061401367,"msg":"request completed"}
{"level":30,"time":1751993440681,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-g","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54834},"msg":"incoming request"}
{"level":30,"time":1751993440683,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-g","res":{"statusCode":200},"responseTime":1.9246249198913574,"msg":"request completed"}
{"level":30,"time":1751993440686,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-h","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":54837},"msg":"incoming request"}
{"level":30,"time":1751993440687,"pid":21136,"hostname":"macs-MacBook-Pro.local","reqId":"req-h","res":{"statusCode":200},"responseTime":0.8150830268859863,"msg":"request completed"}
