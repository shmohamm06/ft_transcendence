[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] })
Environment variables loaded: { CLIENT_ID: 'LOADED', CLIENT_SECRET: 'LOADED', JWT_SECRET: 'LOADED' }
Database path: /home/shmohamm06/trans/ft_transcendence/backend/auth-service/db.sqlite
Initializing database...
Database initialized successfully.
{"level":30,"time":1753810894773,"pid":29744,"hostname":"Shahriars-Laptop","msg":"Server listening at http://0.0.0.0:3001"}
Database connection opened successfully
Users table created/verified
Game_settings table created/verified
User_stats table created/verified
{"level":30,"time":1753810907983,"pid":29744,"hostname":"Shahriars-Laptop","reqId":"req-1","req":{"method":"GET","url":"/api/users/oauth/42/authorize","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":58250},"msg":"incoming request"}
(node:29744) [FSTDEP021] DeprecationWarning: The `reply.redirect()` method has a new signature: `reply.redirect(url: string, code?: number)`. It will be enforced in `fastify@v5`
(Use `node --trace-deprecation ...` to show where the warning was created)
{"level":30,"time":1753810907990,"pid":29744,"hostname":"Shahriars-Laptop","reqId":"req-1","res":{"statusCode":302},"responseTime":6.051468000747263,"msg":"request completed"}
{"level":30,"time":1753810908428,"pid":29744,"hostname":"Shahriars-Laptop","reqId":"req-2","req":{"method":"POST","url":"/api/users/oauth/42/callback","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":58258},"msg":"incoming request"}
OAuth callback received: {
  method: 'POST',
  url: '/api/users/oauth/42/callback',
  body: {
    code: '25677155ad6988e958316404f725566095ab0db47c5f9322eb249909ee5dcadc',
    state: '0ftwzje2mcv'
  },
  query: {},
  headers: {
    'sec-fetch-site': 'same-origin',
    'sec-fetch-mode': 'cors',
    'sec-fetch-dest': 'empty',
    referer: 'http://localhost:3000/auth/42/callback?code=25677155ad6988e958316404f725566095ab0db47c5f9322eb249909ee5dcadc&state=0ftwzje2mcv',
    connection: 'close',
    origin: 'http://localhost:3000',
    'content-length': '97',
    'content-type': 'application/json',
    'accept-encoding': 'gzip, deflate, br, zstd',
    'accept-language': 'en-US,en;q=0.5',
    accept: 'application/json, text/plain, */*',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:141.0) Gecko/20100101 Firefox/141.0',
    host: 'localhost:3001'
  }
}
Processing OAuth callback with code: 25677155ad...
Exchanging code for token with: {
  grant_type: 'authorization_code',
  client_id: 'u-s4t2ud-c9b994e544f314d00e5c9704fd12bad9a0535c183d2444bc9c44329a7ff29ab1',
  client_secret: '[HIDDEN]',
  code: '25677155ad...',
  redirect_uri: 'http://localhost:3000/auth/42/callback',
  url: 'https://api.intra.42.fr/oauth/token'
}
Token exchange successful
OAuth: User from database: {
  user: {
    id: 14,
    username: 'shmohamm',
    email: 'shmohamm@student.42abudhabi.ae',
    avatar: 'https://cdn.intra.42.fr/users/d952ccc5959f843c689ee6f77958d9af/medium_shmohamm.jpg',
    intra_id: 150583,
    intra_login: 'shmohamm',
    auth_provider: '42'
  },
  hasId: true,
  idType: 'number',
  keys: [
    'id',
    'username',
    'email',
    'avatar',
    'intra_id',
    'intra_login',
    'auth_provider'
  ]
}
OAuth: Sending response user: {
  responseUser: {
    id: 14,
    username: 'shmohamm',
    email: 'shmohamm@student.42abudhabi.ae',
    avatar: 'https://cdn.intra.42.fr/users/d952ccc5959f843c689ee6f77958d9af/medium_shmohamm.jpg',
    auth_provider: '42'
  },
  hasId: true,
  idType: 'number',
  serialized: '{"id":14,"username":"shmohamm","email":"shmohamm@student.42abudhabi.ae","avatar":"https://cdn.intra.42.fr/users/d952ccc5959f843c689ee6f77958d9af/medium_shmohamm.jpg","auth_provider":"42"}'
}
OAuth: Final response data: {
  responseData: {
    accessToken: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTQsInVzZXJuYW1lIjoic2htb2hhbW0iLCJlbWFpbCI6InNobW9oYW1tQHN0dWRlbnQuNDJhYnVkaGFiaS5hZSIsImF2YXRhciI6Imh0dHBzOi8vY2RuLmludHJhLjQyLmZyL3VzZXJzL2Q5NTJjY2M1OTU5Zjg0M2M2ODllZTZmNzc5NThkOWFmL21lZGl1bV9zaG1vaGFtbS5qcGciLCJpbnRyYV9pZCI6MTUwNTgzLCJpbnRyYV9sb2dpbiI6InNobW9oYW1tIiwiYXV0aF9wcm92aWRlciI6IjQyIiwiaWF0IjoxNzUzODEwOTEwfQ.08Fmt3JnEBkBoMcBEU_rDt3FupBOXHc7wo7jBlAJao8',
    user: {
      id: 14,
      username: 'shmohamm',
      email: 'shmohamm@student.42abudhabi.ae',
      avatar: 'https://cdn.intra.42.fr/users/d952ccc5959f843c689ee6f77958d9af/medium_shmohamm.jpg',
      auth_provider: '42'
    }
  },
  serializedResponse: '{"accessToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTQsInVzZXJuYW1lIjoic2htb2hhbW0iLCJlbWFpbCI6InNobW9oYW1tQHN0dWRlbnQuNDJhYnVkaGFiaS5hZSIsImF2YXRhciI6Imh0dHBzOi8vY2RuLmludHJhLjQyLmZyL3VzZXJzL2Q5NTJjY2M1OTU5Zjg0M2M2ODllZTZmNzc5NThkOWFmL21lZGl1bV9zaG1vaGFtbS5qcGciLCJpbnRyYV9pZCI6MTUwNTgzLCJpbnRyYV9sb2dpbiI6InNobW9oYW1tIiwiYXV0aF9wcm92aWRlciI6IjQyIiwiaWF0IjoxNzUzODEwOTEwfQ.08Fmt3JnEBkBoMcBEU_rDt3FupBOXHc7wo7jBlAJao8","user":{"id":14,"username":"shmohamm","email":"shmohamm@student.42abudhabi.ae","avatar":"https://cdn.intra.42.fr/users/d952ccc5959f843c689ee6f77958d9af/medium_shmohamm.jpg","auth_provider":"42"}}'
}
{"level":30,"time":1753810910122,"pid":29744,"hostname":"Shahriars-Laptop","reqId":"req-2","res":{"statusCode":200},"responseTime":1694.5314889997244,"msg":"request completed"}
