[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] })
Environment variables loaded: { CLIENT_ID: 'LOADED', CLIENT_SECRET: 'LOADED', JWT_SECRET: 'LOADED' }
Database path: /Users/mac/Desktop/main3/ft_transcendence/backend/auth-service/db.sqlite
Initializing database...
Database initialized successfully.
{"level":30,"time":1753909421646,"pid":79405,"hostname":"macs-MBP","msg":"Server listening at http://0.0.0.0:3001"}
Database connection opened successfully
Users table created/verified
Game_settings table created/verified
User_stats table created/verified
Missing user_stats records created for existing users
{"level":30,"time":1753909438618,"pid":79405,"hostname":"macs-MBP","reqId":"req-1","req":{"method":"GET","url":"/api/settings","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":60399},"msg":"incoming request"}
{"level":30,"time":1753909438619,"pid":79405,"hostname":"macs-MBP","reqId":"req-2","req":{"method":"GET","url":"/api/settings","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":60401},"msg":"incoming request"}
{"level":30,"time":1753909438622,"pid":79405,"hostname":"macs-MBP","reqId":"req-1","res":{"statusCode":200},"responseTime":4.2827500104904175,"msg":"request completed"}
{"level":30,"time":1753909438625,"pid":79405,"hostname":"macs-MBP","reqId":"req-2","res":{"statusCode":200},"responseTime":5.762290954589844,"msg":"request completed"}
{"level":30,"time":1753909440458,"pid":79405,"hostname":"macs-MBP","reqId":"req-3","req":{"method":"GET","url":"/api/settings","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":60399},"msg":"incoming request"}
{"level":30,"time":1753909440458,"pid":79405,"hostname":"macs-MBP","reqId":"req-3","res":{"statusCode":200},"responseTime":0.6422079801559448,"msg":"request completed"}
{"level":30,"time":1753909440468,"pid":79405,"hostname":"macs-MBP","reqId":"req-4","req":{"method":"GET","url":"/api/settings","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":60399},"msg":"incoming request"}
{"level":30,"time":1753909440469,"pid":79405,"hostname":"macs-MBP","reqId":"req-4","res":{"statusCode":200},"responseTime":1.1630419492721558,"msg":"request completed"}
{"level":30,"time":1753909443524,"pid":79405,"hostname":"macs-MBP","reqId":"req-5","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":60408},"msg":"incoming request"}
{"level":30,"time":1753909443526,"pid":79405,"hostname":"macs-MBP","reqId":"req-5","res":{"statusCode":200},"responseTime":1.6719169616699219,"msg":"request completed"}
{"level":30,"time":1753909443530,"pid":79405,"hostname":"macs-MBP","reqId":"req-6","req":{"method":"GET","url":"/api/users/profile","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":60410},"msg":"incoming request"}
{"level":30,"time":1753909443531,"pid":79405,"hostname":"macs-MBP","reqId":"req-6","res":{"statusCode":200},"responseTime":1.0059159994125366,"msg":"request completed"}
{"level":30,"time":1753909447392,"pid":79405,"hostname":"macs-MBP","reqId":"req-7","req":{"method":"GET","url":"/api/users/oauth/42/authorize","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":60413},"msg":"incoming request"}
(node:79405) [FSTDEP021] DeprecationWarning: The `reply.redirect()` method has a new signature: `reply.redirect(url: string, code?: number)`. It will be enforced in `fastify@v5`
(Use `node --trace-deprecation ...` to show where the warning was created)
{"level":30,"time":1753909447394,"pid":79405,"hostname":"macs-MBP","reqId":"req-7","res":{"statusCode":302},"responseTime":1.768375039100647,"msg":"request completed"}
{"level":30,"time":1753909448411,"pid":79405,"hostname":"macs-MBP","reqId":"req-8","req":{"method":"POST","url":"/api/users/oauth/42/callback","hostname":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":60427},"msg":"incoming request"}
OAuth callback received: {
  method: 'POST',
  url: '/api/users/oauth/42/callback',
  body: {
    code: '21d3b51d5c3ec8ebafce336070369e76e465a7733c287bb68c0c629b7eebb3ab',
    state: 'zjk2kc6673m'
  },
  query: {},
  headers: {
    cookie: 'csrftoken=y5uEpcwZCBx6i5UZo9xLvCHsaYi5RYWe',
    'accept-language': 'en,ru-RU;q=0.9,ru;q=0.8,en-US;q=0.7',
    'accept-encoding': 'gzip, deflate, br, zstd',
    referer: 'http://localhost:3000/auth/42/callback?code=21d3b51d5c3ec8ebafce336070369e76e465a7733c287bb68c0c629b7eebb3ab&state=zjk2kc6673m',
    'sec-fetch-dest': 'empty',
    'sec-fetch-mode': 'cors',
    'sec-fetch-site': 'same-origin',
    origin: 'http://localhost:3000',
    'sec-ch-ua-mobile': '?0',
    'content-type': 'application/json',
    'sec-ch-ua': '"Not)A;Brand";v="8", "Chromium";v="138", "Google Chrome";v="138"',
    accept: 'application/json, text/plain, */*',
    'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36',
    'sec-ch-ua-platform': '"macOS"',
    'content-length': '97',
    connection: 'close',
    host: 'localhost:3001'
  }
}
Processing OAuth callback with code: 21d3b51d5c...
Exchanging code for token with: {
  grant_type: 'authorization_code',
  client_id: 'u-s4t2ud-c9b994e544f314d00e5c9704fd12bad9a0535c183d2444bc9c44329a7ff29ab1',
  client_secret: '[HIDDEN]',
  code: '21d3b51d5c...',
  redirect_uri: 'http://localhost:3000/auth/42/callback',
  url: 'https://api.intra.42.fr/oauth/token'
}
Token exchange successful
OAuth: User from database: {
  user: {
    id: 12,
    username: 'tzhakypo',
    email: 'tzhakypo@student.42abudhabi.ae',
    avatar: 'https://cdn.intra.42.fr/users/57ab954fc14b936a12f327d252a45a56/medium_tzhakypo.jpg',
    intra_id: 133443,
    intra_login: 'tzhakypo',
    auth_provider: '42'
  },
  hasId: true,
  idType: 'number',
  keys: [
    'id',
    'username',
    'email',
    'avatar',
    'intra_id',
    'intra_login',
    'auth_provider'
  ]
}
OAuth: Sending response user: {
  responseUser: {
    id: 12,
    username: 'tzhakypo',
    email: 'tzhakypo@student.42abudhabi.ae',
    avatar: 'https://cdn.intra.42.fr/users/57ab954fc14b936a12f327d252a45a56/medium_tzhakypo.jpg',
    auth_provider: '42'
  },
  hasId: true,
  idType: 'number',
  serialized: '{"id":12,"username":"tzhakypo","email":"tzhakypo@student.42abudhabi.ae","avatar":"https://cdn.intra.42.fr/users/57ab954fc14b936a12f327d252a45a56/medium_tzhakypo.jpg","auth_provider":"42"}'
}
OAuth: Final response data: {
  responseData: {
    accessToken: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTIsInVzZXJuYW1lIjoidHpoYWt5cG8iLCJlbWFpbCI6InR6aGFreXBvQHN0dWRlbnQuNDJhYnVkaGFiaS5hZSIsImF2YXRhciI6Imh0dHBzOi8vY2RuLmludHJhLjQyLmZyL3VzZXJzLzU3YWI5NTRmYzE0YjkzNmExMmYzMjdkMjUyYTQ1YTU2L21lZGl1bV90emhha3lwby5qcGciLCJpbnRyYV9pZCI6MTMzNDQzLCJpbnRyYV9sb2dpbiI6InR6aGFreXBvIiwiYXV0aF9wcm92aWRlciI6IjQyIiwiaWF0IjoxNzUzOTA5NDQ5fQ.Ah8hYNpUYlz4zP5KaOc2iUpPMd2sUnPXB9_9_iIde6M',
    user: {
      id: 12,
      username: 'tzhakypo',
      email: 'tzhakypo@student.42abudhabi.ae',
      avatar: 'https://cdn.intra.42.fr/users/57ab954fc14b936a12f327d252a45a56/medium_tzhakypo.jpg',
      auth_provider: '42'
    }
  },
  serializedResponse: '{"accessToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTIsInVzZXJuYW1lIjoidHpoYWt5cG8iLCJlbWFpbCI6InR6aGFreXBvQHN0dWRlbnQuNDJhYnVkaGFiaS5hZSIsImF2YXRhciI6Imh0dHBzOi8vY2RuLmludHJhLjQyLmZyL3VzZXJzLzU3YWI5NTRmYzE0YjkzNmExMmYzMjdkMjUyYTQ1YTU2L21lZGl1bV90emhha3lwby5qcGciLCJpbnRyYV9pZCI6MTMzNDQzLCJpbnRyYV9sb2dpbiI6InR6aGFreXBvIiwiYXV0aF9wcm92aWRlciI6IjQyIiwiaWF0IjoxNzUzOTA5NDQ5fQ.Ah8hYNpUYlz4zP5KaOc2iUpPMd2sUnPXB9_9_iIde6M","user":{"id":12,"username":"tzhakypo","email":"tzhakypo@student.42abudhabi.ae","avatar":"https://cdn.intra.42.fr/users/57ab954fc14b936a12f327d252a45a56/medium_tzhakypo.jpg","auth_provider":"42"}}'
}
{"level":30,"time":1753909449620,"pid":79405,"hostname":"macs-MBP","reqId":"req-8","res":{"statusCode":200},"responseTime":1209.1381249427795,"msg":"request completed"}
